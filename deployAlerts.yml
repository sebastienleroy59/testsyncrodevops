#trigger:
#- main

name: Deploy Alerts using bicep

variables:
   azureServiceConnection: 'SC-MPNSeb'
   resourceGroupName: 'supervisionbiceppoc'
   templateFile: 'allAlerts.bicep'
   parametersFile: '$(System.DefaultWorkingDirectory)/AlertsDefinitions/metricsAlerts.json'
pool:
  name: Default

steps:

- task: PowerShell@2
  inputs:
    pwsh: true
    targetType: inline
    script: | 
      Get-ChildItem $(System.DefaultWorkingDirectory)
      ls -hal
      $csv=import-csv -Delimiter "," "'$(System.DefaultWorkingDirectory)/AlertsDefinitions/testfile.csv"  | ConvertTo-Json 
      $csv
      #((Get-Content -path MetricsAlertsListtst.json -Raw) -replace '"--TOREPLACE--"',$csv) | Set-Content -Path MetricsAlertsListtst2.json
      #$csv
#- task: AzureCLI@2
#  inputs:
#    azureSubscription: $(azureServiceConnection)
#    scriptType: bash
#    scriptLocation: inlineScript
#    inlineScript: |
#      az --version
#      az deployment group create --resource-group $(resourceGroupName) --template-file $(templateFile) --parameters $(parametersFile)