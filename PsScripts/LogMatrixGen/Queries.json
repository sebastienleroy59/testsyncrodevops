[
    {
        "resource":"Microsoft.Network/applicationGateways",
        "queries":[
            "AzureDiagnostics | where ResourceType == APPLICATIONGATEWAYS and OperationName == ApplicationGatewayAccess | summarize AggregatedValue = count() by bin(TimeGenerated, 1h), _ResourceId | render timechart",
            "AzureDiagnostics | where ResourceType == 'APPLICATIONGATEWAYS' and OperationName == 'ApplicationGatewayAccess' and httpStatus_d > 399 | summarize AggregatedValue = count() by bin(TimeGenerated, 1h), ResourceId | render timechart",
            "AzureDiagnostics | where ResourceType == APPLICATIONGATEWAYS and OperationName == ApplicationGatewayAccess | summarize AggregatedValue = count() by clientIP_s | top 10 by AggregatedValue",
            "AzureDiagnostics | where ResourceType == APPLICATIONGATEWAYS and OperationName == ApplicationGatewayAccess and httpStatus_d > 399 | summarize AggregatedValue = count() by userAgent_s, _ResourceId | sort by AggregatedValue desc"
        ]

    },

    {
        "resource":"Microsoft.Compute/virtualMachines",
        "queries":[
            "Heartbeat | summarize TimeGenerated=max(TimeGenerated) by Computer, _ResourceId | extend Duration = datetime_diff('minute',now(),TimeGenerated) | summarize AggregatedValue = min(Duration) by Computer, bin(TimeGenerated,5m), _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == Memory and Name == AvailableMB | extend TotalMemory = toreal(todynamic(Tags)[vm.azm.ms/memorySizeMB]) | extend AvailableMemoryPercentage = (toreal(Val) / TotalMemory) * 100.0 | summarize AggregatedValue = avg(AvailableMemoryPercentage) by bin(TimeGenerated, 15m), Computer, _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == LogicalDisk and Name == FreeSpacePercentage | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == Network and Name == ReadBytesPerSecond | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == Network and Name == WriteBytesPerSecond | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId"
        ]
    },

    {
        "resource":"Microsoft.Web/serverFarms",
        "queries":[
            "AppServiceAppLogs | project CustomLevel, _ResourceId | summarize count() by CustomLevel, _ResourceId",
            "AppServiceHTTPLogs | where ScStatus >= 500 | reduce by strcat(CsMethod, ':\\', CsUriStem)",
            "AppServiceHTTPLogs | summarize avg(TimeTaken), percentiles(TimeTaken, 90, 95, 99) by _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == Network and Name == ReadBytesPerSecond | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId",
            "InsightsMetrics | where Origin == vm.azm.ms | where Namespace == Network and Name == WriteBytesPerSecond | summarize AggregatedValue = avg(Val) by bin(TimeGenerated, 15m), Computer, _ResourceId"
        ]
        
    },

    {
        "resource":"Microsoft.Web/sites",
        "queries":[
            "AppServiceAppLogs | summarize count()  by CustomLevel, bin(TimeGenerated, 1h), _ResourceId | render barchart "
        ]
        
    }
]

    
